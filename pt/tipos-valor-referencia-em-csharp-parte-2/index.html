<!DOCTYPE html>
<html lang="pt-BR">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Tipos de valor e referência em C#, Parte 2 - Por que DateTime não pode ser nulo?</title>
  <meta name="description" content="“Por que uma variável DateTime não pode receber null?” Esta é uma pergunta que vive aparecendo no StackOverflow e site similares. Às vezes escrita de modo um...">
  
  <!-- Twitter card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:creator" content="@carlosschults">
  <meta name="twitter:site" content="@carlosschults">
  <meta name="twitter:domain" content="carlosschults.net">
  <meta name="twitter:title" content="Tipos de valor e referência em C#, Parte 2 - Por que DateTime não pode ser nulo?">
  <meta name="twitter:description" content="“Por que uma variável DateTime não pode receber null?” Esta é uma pergunta que vive aparecendo no StackOverflow e site similares. Às vezes escrita de modo um...">

   <!-- Facebook meta -->
  
  
  <meta property="og:title" content="Tipos de valor e referência em C#, Parte 2 - Por que DateTime não pode ser nulo?">
  <meta property="og:site_name" content="Carlos Schults / Blog" />
  <meta property="og:locale" content="pt_BR">  
  <meta property="og:type" content="article" />
  <meta property="og:image" content="http://res.cloudinary.com/dz5ppacuo/image/upload/v1466341001/csharp-min_buiizq.png" />  
  <meta property="og:image:type" content="image/jpeg">
  <meta property="og:image:width" content="1038"> 
  <meta property="og:image:height" content="437">  
  
  <meta property="og:article:published_time" content="2016-06-19T00:00:00-03:00" />  
  <meta property="og:article:author" content="Carlos Schults" />
  
  <meta property="og:article:tag" content="csharp" />
  <meta property="og:article:tag" content="iniciantes" />
  <meta property="og:article:tag" content="orientacao-a-objetos" />
  <meta property="og:article:tag" content="tipagem" />    
  
  <meta property="og:url" content="http://carlosschults.net/pt/tipos-valor-referencia-em-csharp-parte-2/"/>
  <meta property="og:description" content="“Por que uma variável DateTime não pode receber null?” Esta é uma pergunta que vive aparecendo no StackOverflow e site similares. Às vezes escrita de modo um...">
  <link rel="stylesheet" href="/css/main.css">  
  
   <link rel="canonical" href="http://carlosschults.net/pt/tipos-valor-referencia-em-csharp-parte-2/">
   
  
  <link rel="alternate" hreflang="en" href="/en/value-reference-types-in-csharp-part-2/" />
  <link rel="alternate" hreflang="pt" href="/pt/tipos-valor-referencia-em-csharp-parte-2/" />
  
  <link rel="alternate" type="application/rss+xml" title="carlos schults / blog" href="http://carlosschults.net/rss.xml">
</head>

  <body>

    <header class="site-header">
  <div class="wrapper">    
    <a class="site-title" href="/pt/">carlos schults / blog</a>
    
    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">        
          
          <a class="page-link" href="/sobre/">Sobre</a>
          <a class="page-link" href="/busca/">Busca</a>
                  
      </div>
    </nav>

  </div>

</header>

<div class="wrapper" style="text-align: right; line-height: 2em">
  
   <a href="/en/value-reference-types-in-csharp-part-2/" class="en">en</a>  <a href="/pt/tipos-valor-referencia-em-csharp-parte-2/" class="pt">pt</a> 

  
  
</div>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">    
    <h2 class="postTitle" itemprop="headline">Tipos de valor e referência em C#, Parte 2 - Por que DateTime não pode ser nulo?</h2>
    <p class="post-meta">   
    <time datetime="2016-06-19T00:00:00-03:00" itemprop="datePublished">19/06/2016
    </time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Carlos Schults</span></span>
  <span class="tags" itemprop="keywords"> • Tags: <a href="/tag_ptbr/csharp">csharp </a> <a href="/tag_ptbr/iniciantes">iniciantes </a> <a href="/tag_ptbr/orientacao-a-objetos">orientacao-a-objetos </a> <a href="/tag_ptbr/tipagem">tipagem </a> </span>
  </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><img src="http://res.cloudinary.com/dz5ppacuo/image/upload/v1466341001/csharp-min_buiizq.png" alt="" /></p>

<p>“Por que uma variável DateTime não pode receber <code class="highlighter-rouge">null</code>?” Esta é uma pergunta que vive aparecendo no <em>StackOverflow</em> e site similares. Às vezes escrita de modo um pouco diferente, às vezes com um tipo diferente, mas no fundo é a mesma dúvida. O que é natural, se você considerar que provavelmente milhares de pessoas entram na área a cada ano.
<!--more--></p>

<p>A resposta curta é: porque DateTime/int/float/etc é um <strong>tipo de valor</strong>, e tipos de valor não podem nunca receber <code class="highlighter-rouge">null</code>. Apenas tipos de referência podem.</p>

<p>Legal, mas…por quê?</p>

<p>Em algum momento os projetistas do C# tiveram que tomar essa decisão. Eles deliberadamente decidiram que tipos de valor não poderiam receber <code class="highlighter-rouge">null</code>. Será que tem alguma coisa que naturalmente impede isso? Talvez tenha algo a ver com a pilha e a heap?</p>

<p>Eu acho que antes de tentarmos responder essas questões, seria interessar voltar um passo e pensar um pouco sobre outra questão.</p>

<h2 id="o-que-exatamente-é-null">O que exatamente é null?</h2>

<p>Você provavelmente pensa em <code class="highlighter-rouge">null</code> como uma maneira de representar uma informação que está faltando. Algo desconhecido, ausente ou irrelevante. Talvez um dado que não está onde deveria <em>ainda</em>, mas talvez esteja no futuro.</p>

<p>Lembra do meu <a href="http://carlosschults.net/pt/tipos-valor-referencia-em-csharp/">post anterior sobre tipos de valor e referência</a>? Nele nós vimos que uma variável de um tipo de referência <strong>contém uma referência que aponta para uma instância daquele tipo específico</strong>. Mas quando a variável recebe <em>null</em>, seu conteúdo passa a ser o quê? Nada?</p>

<p>Não exatamente. Ainda que <code class="highlighter-rouge">null</code> essencialmente signifique nada, esse “nada” precisa ser representado de alguma forma na memória do computador.</p>

<p>No C#, a palavra reservada <code class="highlighter-rouge">null</code> representa uma <strong>referência nula</strong>, que é uma referência que não aponta para nenhum objeto. Na prática, essa referência é representada como um número (de 32 ou 64 bits, dependendo do sistema operacional) com todos os bits zerados.</p>

<p>É claro, tudo isso são detalhes de implementação. Isso poderia ter sido implementado de maneiras diferentes, ou seja, não é tão relevante assim pra gente agora. O que você realmente precisa entender é que você <strong>precisa de algo para representar nada</strong>. É necessário algum tipo de valor especial que significa “esse valor está faltando” ou “esse valor é desconhecido”.</p>

<p>Quando você entende isso, fica mais fácil enxergar qual é o problema com tipos de valor.</p>

<h2 id="como-você-representaria-null-para-um-tipo-de-valor">Como você representaria null para um tipo de valor?</h2>

<p>Para entender qual é a dificuldade em fazer um tipo de valor ser nulo, você precisa considerar que tipos de valor geralmente têm um intervalo de valores possíveis que eles são capazes de representar.</p>

<p>É mais fácil de entender isso com um exemplo. Então, considere o tipo de valor <a href="https://msdn.microsoft.com/pt-br/library/system.byte(v=vs.110).aspx">byte</a>.</p>

<p>Esse tipo representa um número inteiro sem sinal de 8 bits. Como 2 elevado a 8 é 256, é possível representar 256 valores. Como é um tipo “sem sinal”, ele só pode representar valores maiores ou igual a zero. Portanto, o range de valores possíveis para esse tipo é <strong>de 0 a 255</strong>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>00000000 =&gt; 0
00000001 =&gt; 1
00000010 =&gt; 2
    .        .
    .        .
    .        .
11111111 =&gt; 255
</code></pre></div></div>

<p>Agora vem a parte complicada. Se os projetistas do C# quisessem que o tipo byte fosse nulável, eles teriam que escolher um dos valores desse intervalo para elegê-lo como o valor nulo. Imagine que eles tivessem escolhido o zero. Nesse caso, <strong>nós nunca poderíamos usar o zero como um valor válido novamente!</strong></p>

<p>Esse é todo o problema: para que um tipo de valor seja nulável, seria necessário sacrificar um dos possíveis valores do intervalo para representar o valor nulo.</p>

<p>Jon Skeet, autor do livro C# In Depth, é capaz de explicar bem melhor do que eu:</p>

<blockquote>
  <p>You’ve got to be able to store the values 0-255 in that variable; otherwise it’s useless for reading arbitrary binary data. With the 256 normal values
and one null value, you’d have to cope with a total of 257 values, and there’s no way of squeezing that many values into a single byte.</p>

  <p>The designers could’ve decided that every value type would have an extra flag bit somewhere determining whether a value was null or contained real data, but the memory usage implications 
are horrible, not to mention the fact that you’d have to check the flag every time you wanted the use the value.</p>
</blockquote>

<p>Em tradução livre:</p>

<blockquote>
  <p>Você precisa ser capaz de armazenar os valores de 0 a 255 naquela variável; do contrário esse tipo seria inútil para ler dados binários arbitrários. Com os 256 valores normais e um valor nulo, você teria que lidar com um total de 257 valores, e não tem jeito de espremer tudo isso em um único byte.</p>
</blockquote>

<blockquote>
  <p>Os projetistas poderiam ter decidido que todo tipo de valor teria um bit extra em algum lugar determinando se um valor é nulo ou contém dados reais, mas as implicações de uso de memória são horríveis, sem falar que você teria que checar esse bit toda vez que quisesse usar o valor.</p>
</blockquote>

<p>Então, não há nada <strong>em princípio</strong> que impede que tipos de valor recebem nulo. É que seria tão complicado que os projetistas da linguagem decidiram que os benefícios de fazer isso não superam os custos.</p>

<h2 id="mas-eu-realmente-preciso-de-um-tipo-de-valor-nulável-e-agora">Mas eu realmente preciso de um tipo de valor nulável. E agora?</h2>

<p>Agora você entende as complicações envolvidas em representar <code class="highlighter-rouge">null</code> para um tipo de valor, e porque os projetistas do C# decidiram contra permitir isso. Mas, e se você realmente precisa fazer isso? Um cenário comum é quando você busca dados de um banco de dados relacional. O que é possível ser feito?</p>

<p>Felizmente há uma solução fácil. Ainda que tipos de valor “normais” não são nuláveis, a versão 2 do C# introduziu a estrutura <code class="highlighter-rouge">Nullable&lt;T&gt;</code>, que permite atribuir <code class="highlighter-rouge">null</code> a praticamente qualquer coisa.</p>

<p>Falarei sobre isso no próximo artigo da série. Como bônus, você vai aprender um pouco sobre outra feature interessante chamada <strong>generics</strong>.</p>

<p>Até lá!</p>

    
    
      
    
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
                    
            <a rel="previous" class="previous" href="/pt/como-escolher-bons-nomes/">&larr; Dez dicas para lhe ajudar a escolher bons nomes </a>
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
        	    
            <a rel="next" class="next" href="/pt/resenha-livro-soft-skills/">Resenha de Livro: Soft Skills &rarr;</a>
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
         
        
        
                
        
        
                
      
    <div id="disqus_thread"></div>
<script>
    /**
     *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
     *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
     */
    /*
    var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    */
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        
        s.src = '//carlosschultsblog.disqus.com/embed.js';
        
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    
  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">
    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">         
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/carlosschults"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">carlosschults</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/carlosschults"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">carlosschults</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Artigos sobre desenvolvimento de software, banco de dados e vários assuntos ligados à tecnologia.</p>
      </div>
    </div>

  </div>

</footer>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-92788641-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>

</html>
